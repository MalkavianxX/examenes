{% extends 'dashboard/admin/dash_admin_base.html' %}{% load static %}


{% block title %}
<title>Ad-mision| Dashboard - Usuarios</title>

{% endblock %} 
{% block descripcion %}
    <meta name="description" content="Aquí podras ver los usuarios activos">
    <meta name="author" content="Ad-mision s Team dev">
{% endblock %}

{% block content %}
    <!--CSS APP-->
    <link href="{% static 'login/assets/css/app-modern.min.css' %}" rel="stylesheet" type="text/css" id="app-style" />

            <!-- ============================================================== -->
            <!-- Start Page Content here -->
            <!-- ============================================================== -->

            <div class="content-page mt-2">
                <div class="content">

                    <!-- Start Content-->
                    <div class="container-fluid">

           


                        <div class="row ">
                            <div class="col-sm-12"> 
                                <!-- Profile -->
                                <div class="card banner" style="background-color: {{user.color}};">
                                    <div class="card-body profile-user-box">
                                        <div class="row">
                                            <div class="col-sm-8">
                                                <div class="row align-items-center ">
                                                    <div class="col-auto">
                                                        <div class="avatar-lg">
                                                            <img src="{{user.icon.url}}" alt="" class=" img-thumbnail">
                                                        </div>
                                                    </div>
                                                    <div class="col">
                                                        <div>
                                                            <h4 class="mt-1 mb-1 ">{{ user.first_name}} {{user.last_name}}</h4>
                                                            {% if user.is_staff %}
                                                            <p class="font-13 "> Colaborador</p>
                                                            {% elif user.is_superuser %}
                                                            <p class="font-13 "> Administrador</p>

                                                            {% else %}
                                                            <p class="font-13 "> Subscriptor</p>

                                                            {% endif %}
    
                                                            <ul class="mb-0 list-inline ">
                                                                <li class="list-inline-item me-3">
                                                                    <h5 class="mb-1 ">{{miperfil.average}}</h5>
                                                                    <p class="mb-0 font-13 ">Promedio general</p>
                                                                </li>
                                                                <li class="list-inline-item">
                                                                    <h5 class="mb-1">{{miperfil.total_test}}</h5>
                                                                    <p class="mb-0 font-13 ">Examenes realizados</p>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div> <!-- end col-->

                                            <div class="col-sm-4">
                                                <div class="text-center mt-sm-0 mt-3 text-sm-end">
                                                    <button type="button" class="btn btn-light"  data-bs-toggle="modal" data-bs-target="#modal-edit-profile">
                                                        <i class="mdi mdi-account-edit me-1"></i> Editar perfil
                                                    </button>
                                                </div>
                                            </div> <!-- end col-->
                                        </div> <!-- end row -->

                                    </div> <!-- end card-body/ profile-user-box-->
                                </div><!--end profile/ card -->
                            </div> <!-- end col-->
                        </div>
                        <!-- end row -->


                        <div class="row">
                            <div class="col-xl-4">
                                <!-- Personal-Information -->
                                <div class="card">
                                    <div class="card-body">
                                        <div class="d-flex justify-content-between">
                                            <h4 class="header-title mt-0 align-self-center mb-3">Mi informacíon</h4>
                                            <a type="button" data-bs-toggle="modal" data-bs-target="#modal-add-user" class="fs-4 link-secondary"> <i class="mdi mdi-pencil-outline"></i> </a>
                                        </div>

                                        <p class="text-muted font-13">
                                            {{ user.description }}
                                        </p>

                                        <hr/>

                                        <div class="text-start">
                                            <p class="text-muted"><strong>Nombre completo :</strong> <span class="ms-2">{{ user.first_name}} {{user.last_name}}</span></p>

                                            <p class="text-muted"><strong>Nombre de usuario :</strong> <span class="ms-2">{{ user.email }} </span></p>

                                            <p class="text-muted"><strong>Correo :</strong> <span class="ms-2">{{ user.email }} </span></p>
                                            
                                            <a href="#"  data-bs-toggle="modal" data-bs-target="#recovery-password" class=" link-underline-secondary"><strong>Cambiar mi contraseña </strong></a>


                                         

                                        </div>
                                    </div>
                                </div>
                                <!-- Personal-Information -->

                                <div class="row">
                                    <div class="col-sm-12">
                                        <div class="card tilebox-one">
                                            <div class="card-body">
                                                <i class="ri-shopping-basket-2-line float-end text-muted"></i>
                                                <h6 class="text-muted text-uppercase mt-0">Examenes aprovados</h6>
                                                <h2 class="m-b-20">{{miperfil.test_aproval}}</h2>
                                                <span class="badge bg-primary"> +11% </span> <span class="text-muted">Desde el ultimo día</span>
                                            </div> <!-- end card-body-->
                                        </div> <!--end card-->
                                    </div><!-- end col -->

                                    <div class="col-sm-12">
                                        <div class="card tilebox-one">
                                            <div class="card-body">
                                                <i class="ri-archive-line float-end text-muted"></i>
                                                <h6 class="text-muted text-uppercase mt-0">Temas estudiados</h6>
                                                <h2 class="m-b-20"><span>{{miperfil.categorias_diferentes}}</span></h2>
                                                <span class="badge bg-danger"> -29% </span> <span class="text-muted">Desde el principio</span>
                                            </div> <!-- end card-body-->
                                        </div> <!--end card-->
                                    </div><!-- end col -->

                                    <div class="col-sm-12">
                                        <div class="card tilebox-one">
                                            <div class="card-body">
                                                <i class="ri-vip-diamond-line float-end text-muted"></i>
                                                <h6 class="text-muted text-uppercase mt-0">Examenes reprobados</h6>
                                                <h2 class="m-b-20">{{miperfil.test_failures}}</h2>
                                                <span class="badge bg-primary"> +0% </span> <span class="text-muted">Desde el ultimo día</span>
                                            </div> <!-- end card-body-->
                                        </div> <!--end card-->
                                    </div><!-- end col -->

                                </div>
                                <!-- end row -->

                 

                            </div> <!-- end col-->

                            <div class="col-xl-8">

                                <!-- Chart-->
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mb-3">Mis examenes hechos (ultimos 7 días)</h4>
                                        <input type="text" value="{{data_general}}" id="examenes_por_dia" class="d-none">

                                        <div dir="ltr">
                                            <div class="mt-3 chartjs-chart " style="height: 260px;">
                                                <canvas id="point-styling-example" data-colors="#727cf5,#0acf97"></canvas>
                                            </div>
                                        </div>
                                       
                                    </div>
                                </div>
                                <!-- End Chart-->

   


                                <div class="card">
                                    <div class="card-header d-flex justify-content-between align-items-center">
                                        <h4 class="header-title">Historial</h4>
                                        <div class="dropdown">
                                            <a href="#" class="dropdown-toggle arrow-none card-drop" data-bs-toggle="dropdown" aria-expanded="false">
                                                <i class="mdi mdi-dots-vertical"></i>
                                            </a>
                                            <div class="dropdown-menu dropdown-menu-end">
                                                <!-- item-->
                                                <a href="{% url 'view_test_complete_admin' user.id %}" class="dropdown-item">Ver todos</a>
                                      
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-header bg-light-lighten border-top border-bottom border-light py-1 text-center">
                                        <p class="m-0"><b>{{miperfil.total_test}}</b> examenes completados</p>
                                    </div>
                                    <div class="card-body pt-2">
                                        <div class="table-responsive">
                                            <table class="table table-centered table-nowrap table-hover mb-0">
                                                <tbody>
                                                    {% for examen in misexamenes %}
                                                    <tr>
                                                        <td>
                                                            <h5 class="font-14 my-1"><a href="{% url 'view_result_examen' examen.id %}" class="text-body">{{examen.test.title}}</a></h5>
                                                            <span class="text-muted font-13">{{examen.fecha_anotada}}</span>
                                                        </td>
        
                                                        {% if examen.status  == "Aprobado" %}
                                                            <td>
                                                                <span class="text-muted font-13">Estado</span> <br/>
                                                                <span class="badge badge-success-lighten">{{examen.status}}</span>
                                                            </td>                                                
                                                        {% elif examen.status  == "Reprobado" %}
                                                        <td>
                                                            <span class="text-muted font-13">Estado</span> <br/>
                                                            <span class="badge badge-danger-lighten">{{examen.status}}</span>
                                                        </td>        
                                                        {% elif examen.status  == "Incompleto" %}
                                                        <td>
                                                            <span class="text-muted font-13">Estado</span> <br/>
                                                            <span class="badge badge-primary-lighten text-capitalize">{{examen.status}}</span>
                                                        </td>   
                                                        {% else %}
                                                        <td>
                                                            <span class="text-muted font-13">Estado</span> <br/>
                                                            <span class="badge badge-secondary-lighten">{{examen.Incompleto}}</span>
                                                        </td>        
                                                        {% endif %}
                                                       
                                                
                                                        <td>
                                                            <span class="text-muted font-13">Materia</span>
                                                            <h5 class="font-14 mt-1 fw-normal">{{examen.test.category.name}}</h5>
                                                        </td>
                                                        <td>
                                                            <span class="text-muted font-13">Calificación</span>
                                                            <h5 class="font-14 mt-1 fw-normal">{{examen.score}}</h5>
                                                        </td>
                                                   
                                                    
                                                    </tr>
                                                    {% endfor %}
                                                
                                                    
                                                </tbody>
                                            </table>
                                        </div> <!-- end table-responsive-->
        
                                    </div> <!-- end card body-->
                                </div> <!-- end card -->

                            </div>
                            <!-- end col -->

                        </div>
                        <!-- end row -->
                        
                    </div> <!-- container -->

                </div> <!-- content -->

                <!-- Footer Start -->
                <footer class="footer">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-6">
                                <script>document.write(new Date().getFullYear())</script> © Ad-mision - Team´s Dev 
                            </div>
                            <div class="col-md-6">
                                <div class="text-md-end footer-links d-none d-md-block">
                                    <a href="javascript: void(0);">About</a>
                                    <a href="javascript: void(0);">Support</a>
                                    <a href="javascript: void(0);">Contact Us</a>
                                </div>
                            </div>
                        </div>
                    </div>
                </footer>
                <!-- end Footer -->

            </div>

            <!-- ============================================================== -->
            <!-- End Page content -->
            <!-- ============================================================== -->

            <!-- ============================================================== -->
            <!-- MODAL EDIT USER -->
            <!-- ============================================================== -->

            <div id="modal-add-user" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="primary-header-modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-primary">
                            <h4 class="modal-title" id="primary-header-modalLabel " style="color: white;">Editar mi información</h4>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{% url 'fun_upDataUser' %}" id="form-add-user"  method="post"> {% csrf_token %}
                                <input type="text" name="iduser" class="d-none" value="{{user.id}}">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="nameuser" name="nameuser" value="{{user.username}}" placeholder="name@example.com">
                                    <label for="floatingInput">Nombre de usuario</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="first_name" name="first_name" value="{{user.first_name}}" placeholder="name@example.com">
                                    <label for="floatingInput">Nombre(s)</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="last_name" name="last_name" value="{{user.last_name}}" placeholder="name@example.com">
                                    <label for="floatingInput">Apellido(s)</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="mailuser" name="mailuser" value="{{user.email}}" placeholder="name@example.com">
                                    <label for="floatingInput">Correo electronico</label>
                                </div>
                                <div class="form-floating mb-3">
                                    <textarea class="form-control"  placeholder="Leave a comment here" name="descripcion" id="descripcion">{{ user.description }}</textarea>
                                    <label for="floatingTextarea">Descripción</label>
                                  </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Guardar</button>
                                </div>
                            </form>
                        </div>
                   
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->

            <!-- ============================================================== -->
            <!-- END MODAL EDIT USER -->
            <!-- ============================================================== -->


           <!-- ============================================================== -->
            <!-- MODAL EDIT USER -->
            <!-- ============================================================== -->

            <div id="modal-edit-profile" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="primary-header-modalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header bg-primary">
                            <h4 class="modal-title" id="primary-header-modalLabel " style="color: white;">Editar mi perfil</h4>
                            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-hidden="true"></button>
                        </div>
                        <div class="modal-body">
                            <form action="{% url 'fun_upProfileUser' %}" id="form-Up-profile"  method="post"> {% csrf_token %}
                                <!--COLOR-->
                                <div class="mb-3">
                                    <label for="colorback" class="form-label">Color de fondo</label>
                                    <input type="color" class="form-control form-control-lg" id="colorback" name="colorback" value="{{user.color}}" title="Choose your color">
                                </div>
                                <!--AVATARES-->
                                <label for="" class="form-label">Elige tu avatar</label>
                                <div class="row text-center">
                                    <div class="col-3 mb-2 " >
                                        <img id="avatar1" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2 ">
                                        <img id="avatar2" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="bg-success img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2 ">
                                        <img id="avatar3" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2 ">
                                        <img id="avatar4" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2 ">
                                        <img id="avatar5" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="bg-success img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2 ">
                                        <img id="avatar6" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2 ">
                                        <img id="avatar7" src="{% static 'login/assets/images/users/avatar-2.jpg' %}" alt="image" class="img-fluid avatar-md rounded-circle">
                                    </div>
                                    <div class="col-3 mb-2">
                                        <div class="avatar-md">
                                            <span id="avatar8" onclick="subirImagen()" class="avatar-title bg-light rounded-circle"><h1 class="text-muted">+</h1></span>
                                        </div>
                                    </div>
                                </div>
                                <!--PRELOAD-->
                                <label for="" class="form-label mt-2">Mi nuevo perfil</label>
                                <div class="row  justify-content-start" >
                                    <div id="color-previsualizacion" class="col-12 text-start"style="border-radius: 15px;background-color: {{user.color}};">
                                        <img id="avatar-visualizacion" src="{{user.icon.url}}" alt="image" class="img-fluid avatar-xl rounded-circle">

                                    </div>
                                </div>
                                <!--INPUTS A ENVIAR -->
                                <div class="d-none">
                                    <input type="text" name="color" value="" id="color">
                                    <input type="text" name="avatar" id="avatar" value="">
                                    <input type="text" name="iduser" id="iduser" value="{{user.id}}">
                                </div>

                                <div class="modal-footer">
                                    <button type="button" class="btn btn-light" data-bs-dismiss="modal">Cancelar</button>
                                    <button type="submit" class="btn btn-primary">Guardar</button>
                                </div>
                            </form>
                        </div>
                   
                    </div><!-- /.modal-content -->
                </div><!-- /.modal-dialog -->
            </div><!-- /.modal -->

            <!-- ============================================================== -->
            <!-- END MODAL EDIT USER -->
            <!-- ============================================================== -->          
            
            

            <!-- Signup modal-->
<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#signup-modal">Sign Up Modal</button>
<div id="signup-modal" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">

            <div class="modal-body">
                <div class="text-center mt-2 mb-4">
                    <a href="index.html" class="text-success">
                        <span><img src="assets/images/logo-dark.png" alt="" height="18"></span>
                    </a>
                </div>

                <form class="ps-3 pe-3" action="#">

                    <div class="mb-3">
                        <label for="username" class="form-label">Name</label>
                        <input class="form-control" type="email" id="username" required="" placeholder="Michael Zenaty">
                    </div>

                    <div class="mb-3">
                        <label for="emailaddress" class="form-label">Email address</label>
                        <input class="form-control" type="email" id="emailaddress" required="" placeholder="john@deo.com">
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Password</label>
                        <input class="form-control" type="password" required="" id="password" placeholder="Enter your password">
                    </div>

                    <div class="mb-3">
                        <div class="form-check">
                            <input type="checkbox" class="form-check-input" id="customCheck1">
                            <label class="form-check-label" for="customCheck1">I accept <a href="#">Terms and Conditions</a></label>
                        </div> 
                    </div>

                    <div class="mb-3 text-center">
                        <button class="btn btn-primary" type="submit">Sign Up Free</button>
                    </div>

                </form>

            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->

<!-- Login modal -->
<div id="recovery-password" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-body">
                <div class="text-center mt-2 mb-4">
                    <a href="{% url 'view_dashboard' %}" class="text-success">
                        <span><img src="{% static 'login/assets/images/logo-dark.png' %}" alt="" height="18"></span>
                    </a>
                </div>

                <form action="{% url 'fun_changePassword' %}" method="post" class="ps-3 pe-3 needs-validation" id="passwordForm" novalidate>{% csrf_token %}

                    <div class="mb-3">
                        <label for="password1" class="form-label">Nueva contraseña</label>
                        <input class="form-control" type="password" id="password1" name="password1" required="" placeholder="Nueva contraseña">
                        <div class="invalid-feedback">
                            La contraseña debe tener al menos 6 caracteres.
                        </div>
                    </div>
                
                    <div class="mb-3">
                        <label for="password2" class="form-label">Confirma tu contraseña</label>
                        <input class="form-control" type="password" required="" name="password2" id="password2" placeholder="Confirmar mi nueva contraseña">
                        <div class="invalid-feedback">
                            Las contraseñas no coinciden.
                        </div>
                    </div>
                    <input type="text" name="iduserpass" id="iduserpass" class="d-none" value="{{user.id}}">
                    <div class="mb-3 text-center">
                        <button class="btn rounded-pill btn-primary" type="submit" disabled id="submitBtn">Cambiar contraseña</button>
                    </div>
                
                </form>

            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
    <!-- Vendor js -->
    <style>
        .img-fluid.avatar-md.rounded-circle {
    cursor: pointer;
}
.avatar-md{
    cursor: pointer;
}
    </style>

    <script src="{% static 'login/assets/js/vendor.min.js' %}"></script>

             <!-- Chart.js-->
             <script src="{% static 'login/assets/vendor/chart.js/chart.min.js' %}"></script>
                     <!-- Datatable Demo Aapp js -->
        <script src="{% static 'usuario/js/chart.js' %}"></script>
        <script src="{% static 'usuario/js/funciones.js' %}"></script>

    <!-- App js -->
    <script src="{% static 'login/assets/js/app.min.js' %}"></script>
{% endblock %}